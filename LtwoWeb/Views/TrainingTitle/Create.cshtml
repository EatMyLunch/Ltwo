@model TrainingTitle

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>

<h2>Create Training Title</h2>

<form asp-action="Create">
    <div class="form-group">
        <label>Department</label>
        <select id="departments" class="form-control">
            <option value="">-- Select Department --</option>
            @foreach (var department in ViewBag.Departments)
            {
                <option value="@department.DepartmentId">@department.Name</option>
            }
        </select>
    </div>

    <div class="form-group">
        <label>Training Type</label>
        <select id="trainingTypes" class="form-control" disabled>
            <option value="">-- Select Training Type --</option>
        </select>
    </div>

    <div class="form-group">
        <label>Category</label>
        <select asp-for="CategoryId" class="form-control" disabled>
            <option value="">-- Select Category --</option>
        </select>
    </div>

    <div class="form-group">
        <label asp-for="Name">Training Title</label>
        <input asp-for="Name" class="form-control" />
    </div>

    <input type="submit" value="Create" class="btn btn-primary" />
</form>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function () {
            $("#departments").change(function () {
                var departmentId = $(this).val();
                fetchDropdownData(departmentId, "/TrainingTitle/GetTrainingTypesByDepartmentId", "#trainingTypes");
            });

            $("#trainingTypes").change(function () {
                var trainingTypeId = $(this).val();
                fetchDropdownData(trainingTypeId, "/TrainingTitle/GetCategoriesByTrainingTypeId", "#CategoryId");
            });
        });

        function fetchDropdownData(id, endpoint, dropdownSelector) {
            if (id) {
                $.ajax({
                    url: endpoint + "/" + id,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        $(dropdownSelector).empty();
                        $(dropdownSelector).append('<option value="">-- Select --</option>');
                        $.each(data, function (key, entry) {
                            $(dropdownSelector).append($('<option></option>').attr('value', entry.id).text(entry.name));
                        });
                        $(dropdownSelector).removeAttr("disabled");
                    }
                });
            } else {
                $(dropdownSelector).empty().attr("disabled", "disabled");
            }
        }

    </script>
}
